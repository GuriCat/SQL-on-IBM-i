# 2 IBM i とSQL

　

## 2.1 世間のSQL実装

最初に、世の中のSQL実装について簡単におさらいしましょう。

SQLはデータの操作や定義を行うためのデータベース言語です。SQLを使うと、データベース操作を柔軟に、かつ、場合によっては高速・効率的に実行できます。

![2.1_世間のSQL実装.jpg](/files/2.1_世間のSQL実装.jpg)

1986年に発表され、1987年に批准されたSQL86が最初のSQL統一標準規格です。

?> 国際標準の「SQL」は特に何かの略語ではありません。IBMの「SQL」は「Structured Query Language」の略です。

その後、だいたい3年おきくらいに改訂が行われていますが、規格への対応はベンダーごとにバラバラなのが現状です。歴史が古いRDBMSは独自機能が多いのですが、アプリケーションの互換性維持のためになかなか廃止できず、移行の妨げになることもあります。

主なSQL製品・実装には、IBMのDb2、オラクルのOracle Database 、マイクロソフトのSQL Server、オープンソースのMySQLやPostgreSQLなどがあります。SQLは標準データベース言語として今後も広く利用されるでしょう。

?> 2017年にリブランドされて「b」が小文字になりました。[https://www.ibm.com/blogs/solutions/jp-ja/ibm-db2-rebranding/](https://www.ibm.com/blogs/solutions/jp-ja/ibm-db2-rebranding/)

　

## 2.2 IBM i のSQL

IBM i ではその前身のAS/400発表時からSQLがサポートされています。

![2.2_IBM_i_のSQL.jpg](/files/2.2_IBM_i_のSQL.jpg)

他のサーバーではRDBMSとSQLはOSとは別で、必要な場合に後付けでミドルウェアとしてインストールします。これに対し、IBM i はRDBMSやSQL機能がOSの基本機能として緊密・不可分に統合されています。これにより、実行管理、セキュリティ、バックアップなど、OSと一体化した統合運用を実現しています。

?> RPGやCOBOLで組み込みSQLを使用する、あるいは、対話型SQLを使用する場合は「SQL開発キット」(57xx-ST1)を購入します。「SQL開発キット」が無くても、組み込みSQLアプリケーションの実行が可能です。また、対話型SQLではデータベース管理やSQLの実行ができますが、ACSのSQLスクリプトやRUNSQL CLコマンド、Qshellのdb2コマンドなどで同様の操作が可能です。

?> Db2 for i に独立した「バージョン」は存在せず、IBM i のバージョンがDb2 for i のバージョンになります。Db2 for i はIBM i のリリースごとに大幅な機能拡張が行われており、IBM i 7.4では国際標準の2016年版に準拠しています。

例えば、RDBMSの修正プログラムも、IBM i 全体として整合性のある、検証済みの状態で提供されます。通常、ユーザーが前提や組合せを調査・確認する必要はありません。

また、ユニコード、JDBCやODBC、.NETなどのインターフェース、そしてIBMの分散関係データベース体系であるDRDA(Distributed Relational Database Architecture)をサポートします。

---

IBMのDb2ファミリーには、z/OS、Linux/UNIX/Windows用のLUW、そしてDb2 for i があります。Db2 for i は、これらDb2ファミリーと高いレベルでの相互運用が可能です。SQLアプリケーションの可搬性を高めるため、Db2ファミリー間の互換性は継続して強化されています。

可搬性の早見表(Quick reference)として、プラットフォーム毎のSQL機能のサポート状況を表した「Selected common SQL features for developers of portable Db2 applications」がAs-Is(現状のまま)で提供されており、下の図の左側のグラフはプラットフォーム毎に、一般的なSQLアプリケーション機能のサポート状況(フルサポート、あるいは、部分サポート)を示します。

![2.2_Db2ファミリーの互換性.jpg](/files/2.2_Db2ファミリーの互換性.jpg)

これによると、フルサポートされている項目の割合は、Db2 for i が99%、LUW 92%、z/OS 88%であり、Db2 for i が最多となっています。つまり、多くのケースで、LUWやz/OSで動くSQLは、IBM i でも少ない修正で動作すると推測されます。

?> この数値がSQLアプリケーションの移植のワークロードと必ずしも比例しないことに留意してください。特定のSQL機能の非互換性に対応するために、多大な修正が発生する事も考えられます。

　

## 2.3 Db2 for i の用語

SQLに関連する用語・呼称について解説します。

RDBMSによって、同じ概念・機能を異なる名前で呼んでいます。一般的なSQLの参考文献を参照したり、他のサーバーと相互接続するアプリケーションを開発したりする場合、言葉を合わせる必要があります。

このような差異には、「Db2 for i とそれ以外(z/OSおよびLUW)」の差異と、「Db2とそれ以外(OracleやMySQLなど)」の差異の2種類があるので、それぞれを見ていきましょう。まずはDb2 for i とそれ以外の用語の差異です。

IBM i (厳密にはS/38)は、SQL標準化前からRDBMSを提供しているため、現在広く使われている用語と基本用語が異なります。

![2.3_Db2_for_i_の用語.jpg](/files/2.3_Db2_for_i_の用語.jpg)

表のように、例えば他のRDBMSで「データベース」と呼ばれるものは、IBM i では「リレーショナルデータベースディレクトリー項目」を示します。

同様に、IBM i の「ライブラリー」、「物理ファイル」、「論理ファイル」は、それぞれ、「schema/collection」、「table」、「view/index」と呼ばれます。

表にはありませんが、IBM i の「ジャーナル」および「ジャーナルレシーバー」に相当するものは、各種「ログ」と呼ばれることが多いです。

---

国際標準であるANSI/ISOとDb2でも用語が異なります。

これも表にしたのでご覧ください 。元の英語表現が大きく異なり、日本語はほぼその直訳になっています。

?> 詳細はIBM Knowledge Centerで「IBM i 7.4」＞「データベース」＞「参照」＞「SQL解説書」＞「用語の差異」を参照。

![2.3_ANSI_ISOとDb2の用語.jpg](/files/2.3_ANSI_ISOとDb2の用語.jpg)

基本的な用語でも全く違う呼び方であることが分ります。多種データベースを利用するプロジェクトでは、最初に用語集を作成するなどして誤解・混乱を避けるのが望ましいでしょう。

?> IBMの資料でもANSI/ISO用語を使用している場合も見られます。例えば、「作業論理単位」ではなく、「トランザクション」がUOWの意味で使われる場合もあります。

---

用語の最後に、主要なDb2 for i 独自のキーワードを紹介します。

この資料ではDb2 for i の高度な機能や、内部構造、パフォーマンスチューニングなどのトピックには触れません。

次のチャートは、Db2 for i のSQLを使い始めて直面する事の多い、パフォーマンスに関わる重要なキーワードを青字で示しました。

![2.3_Db2_for_i_独自キーワード.jpg](/files/2.3_Db2_for_i_独自キーワード.jpg)

個別の解説はしませんので、それぞれどのような物かを概要だけでも覚えておくと良いでしょう。Db2 for i を理解・活用するには、これらの用語に加えて、RCAC、テンポラル表、OLAP機能など、幅広く学習することをお勧めします。

